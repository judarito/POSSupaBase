@using CommonBase.Services.AuthService;
@using Microsoft.AspNetCore.Components.Authorization
@using CommonBase.Models.Login;
@using CommonBase.Services.Login;
@using CommonBase.Shared.Services;
@inject ILoginService LoginService
@inject AuthService AuthService
@inject NavigationManager Navigation



<RadzenCard class="rz-my-12 rz-mx-auto rz-p-4 rz-p-md-12" style="max-width: 600px;">
    <RadzenTemplateForm Data=@("SimpleLogin")>
        <RadzenLogin AllowRegister="false" AllowResetPassword="false" Username=@userName Password=@password
                     AllowRememberMe="false" RememberMe="@rememberMe"
                     Login=@(args => OnLogin(args, "Login with default values")) />
    </RadzenTemplateForm>
</RadzenCard>



@code {
    string userName = "";
    string password = "";
    bool rememberMe = false;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        userName = "";
        password = "";
    }



    async void OnLogin(LoginArgs args, string name)
    {
        try
        {
            await AuthService.Login(args.Username, args.Password);
            Navigation.NavigateTo($"/");
           /* SessionResponse result = await LoginService.Login(new SessionRequest() { UserName = args.Username, Password = args.Password });

            if (result.status == "OK")
            {
                //await sessionStorage.SetItemAsStringAsync("jwt", result.token);
                await sessionStorage.SetItemAsStringAsync("UserName", result.userName);
                await sessionStorage.SetItemAsStringAsync("DisplayName", result.displayName);
                await authStateProvider.SetTokenAsync(result.token);
                Navigation.NavigateTo($"");
            }
            else
            {
                AppUtils.ShowNotify(result.errorMessage, "ERROR", Ns);
            }*/

        }
        catch (Exception ex)
        {
            AppUtils.ShowNotify(ex.Message, "ERROR", Ns);
        }
       
    }

    void OnRegister(string name)
    {
        Console.WriteLine($"{name} -> Register");
    }

    void OnResetPassword(string value, string name)
    {
        Console.WriteLine($"{name} -> ResetPassword for user: {value}");
    }
}