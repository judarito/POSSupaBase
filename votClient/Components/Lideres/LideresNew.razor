@using System.Text.Json;
@using votClient.Models;
@using votClient.Services.Lideres;
@inject ILideresService lideresService
<PageTitle>Líderes</PageTitle>

<h1>Nuevo Líder</h1>

@if (lider == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <RadzenTemplateForm Data="@lider" Submit="@((Lider args) => { Submit(args); })">
        <RadzenRow Gap="2rem" Class="rz-p-0 rz-p-lg-4">
            <RadzenColumn Size="12" SizeMD="11">
                <RadzenStack>
                    <RadzenFieldset Text="Datos del Líder">
                        <RadzenStack Gap="1rem">

                            <RadzenRow AlignItems="AlignItems.Center">
                                <RadzenColumn Size="12" SizeMD="2">
                                    <RadzenLabel Text="Nombre" />
                                </RadzenColumn>
                                <RadzenColumn Size="12" SizeMD="9">
                                    <RadzenTextBox Style="width: 100%;" Name="nombre" @bind-Value="lider.Nombre" />
                                    <RadzenRequiredValidator Component="nombre" Text="Nombre es requerido" Popup=@popup Style="position: relative" />
                                </RadzenColumn>
                            </RadzenRow>

                            <RadzenRow AlignItems="AlignItems.Center">
                                <RadzenColumn Size="12" SizeMD="2">
                                    <RadzenLabel Text="Cedula" />
                                </RadzenColumn>
                                <RadzenColumn Size="12" SizeMD="9">
                                    <RadzenTextBox Style="width: 100%;" Name="cedula" @bind-Value="lider.Cedula" />
                                    <RadzenRequiredValidator Component="cedula" Text="Cedula es requerido" Popup=@popup Style="position: relative" />
                                </RadzenColumn>
                            </RadzenRow>

                            <RadzenRow AlignItems="AlignItems.Center">
                                <RadzenColumn Size="12" SizeMD="2">
                                    <RadzenLabel Text="Telefono" />
                                </RadzenColumn>
                                <RadzenColumn Size="12" SizeMD="9">
                                    <RadzenTextBox Style="width: 100%;" Name="telefono" @bind-Value="lider.Telefono" />
                                </RadzenColumn>
                            </RadzenRow>

                            <RadzenRow AlignItems="AlignItems.Center">
                                <RadzenColumn Size="12" SizeMD="2">
                                    <RadzenLabel Text="Referido" />
                                </RadzenColumn>
                                <RadzenColumn Size="12" SizeMD="9">
                                    <RadzenTextBox Style="width: 100%;" Name="referido" @bind-Value="lider.Referido" />
                                </RadzenColumn>
                            </RadzenRow>
                        </RadzenStack>
                    </RadzenFieldset>

                </RadzenStack>
            </RadzenColumn>

        </RadzenRow>
        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.Center" Gap="1rem" Class="rz-mt-8 rz-mb-4">
            <RadzenButton ButtonType="ButtonType.Submit" Size="ButtonSize.Large" Icon="save" Text="Save" />
            <RadzenButton ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.Large" Icon="cancel" Text="Cancel" Click="@Cancel" />
        </RadzenStack>
    </RadzenTemplateForm>
}



@code {

    [Parameter]
    public int? id { get; set; }

    private Lider? lider;
    bool popup = true;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        lider = new Lider();

        if (id != null && id > 0)
        {
            try
            {
                lider = await lideresService.GetById(id);
            }
            catch (Exception ex)
            {
                AppUtils.ShowNotify(ex.Message, "ERROR", Ns);
            }

        }


    }

    async void Submit(Lider arg)
    {
        var response = arg?.Id != null && arg?.Id > 0 ? await lideresService.Update(arg) : await lideresService.Create(arg);

        if (!response.IsSuccessStatusCode)
        {
            AppUtils.ShowNotify($"{response.ReasonPhrase} : {await response.Content.ReadAsStringAsync()} ", "WARNING", Ns);
            return;
        }

        lider = new Lider();
        AppUtils.ShowNotify("Información guardada de manera exitosa", "OK", Ns);
        Navigation.NavigateTo("lideres");
    }

    void Cancel()
    {
        Navigation.NavigateTo("lideres");
    }
}
